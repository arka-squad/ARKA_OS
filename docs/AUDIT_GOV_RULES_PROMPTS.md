# Audit — Gouvernance & Rules Prompt (hors Event Bus)

## Résumé exécutif
- Les briques de gouvernance globales (ARKORE02, ARKORE06, ARKORE15, ARKORE17, ARKORE12) définissent des principes clairs (anti-dérive, matrices d'autorité, contrôles AGP, prérequis par rôle, catalogues d'actions), mais elles sont dispersées sans index commun ni versioning croisé pour les intents déclenchés par prompt.【F:ARKA_CORE/bricks/ARKORE02-GLOBAL-RULES.yaml†L1-L58】【F:ARKA_CORE/bricks/ARKORE06-CONTROL-MATRICES.yaml†L1-L68】【F:ARKA_CORE/bricks/ARKORE15-AGP-REACTIVE-CONTROL.yaml†L1-L88】【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L1-L151】【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L1-L196】
- La matrice des wakeups recense bien les profils et intents par défaut, mais plusieurs entrées laissent la liste `intents` vide alors que les fichiers wakeup/experts exposent des intents actifs, signe d'une synchronisation incomplète.【F:wakeup-intents.matrix.yaml†L5-L200】【F:ARKA_AGENT/client/acme/wakeup/ARKAA08-WAKEUP-ARCHIVIST.yaml†L1-L22】
- L'absence d'une cartographie « intent → action_key → capacité → contexte » formelle conduit à des alias ponctuels et à des prérequis difficilement traçables, compliquant la scalabilité des règles promptées.【F:ARKA_AGENT/client/acme/ARKAA14-VOCAB-ALIASES.yaml†L1-L11】【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L31-L151】【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L21-L196】

## Liste des règles gouvernantes actives
| Brique | Version | Champs structurants | Couplages / dépendances |
| --- | --- | --- | --- |
| ARKORE02-GLOBAL-RULES | 1.1.0 | Principes fondateurs, anti-dérive (no_self_validation, cross_validation), isolation, procédures d'urgence | Référence hiérarchie (ARKORE01), exige audit log pour bypass owner.【F:ARKA_CORE/bricks/ARKORE02-GLOBAL-RULES.yaml†L1-L58】 |
| ARKORE06-CONTROL-MATRICES | 1.0.0 | Matrice d'autorité, escalades S0-S3, budgets de performance, critères DoR/DoD | S'appuie sur patterns (ARKORE09), paths (ARKORE08), budgets utilisés par AGP (ARKORE15).【F:ARKA_CORE/bricks/ARKORE06-CONTROL-MATRICES.yaml†L1-L55】 |
| ARKORE15-AGP-REACTIVE-CONTROL | 1.0.0 | Runtime sans pause, événement DELIVERY_RECEIVED, zones de tuning, action_map | Consomme contrôles/évidence ARKORE06 et templates ARKORE13 ; impose MEMORY_UPDATE post-actions.【F:ARKA_CORE/bricks/ARKORE15-AGP-REACTIVE-CONTROL.yaml†L11-L79】 |
| ARKORE17-ORCHESTRATION-RULES | 2.0.0 | Prérequis par rôle (all/common/role), contraintes (no_self_validation), gates workflow | Référence toutes briques clés, y compris Event Bus, mais pas de mapping explicite vers action_keys ou intents CLI.【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L7-L151】 |
| ARKORE12-ACTION-KEYS | 2.1.0 | Ancres de 96 actions, templates (create/read/update...), type_configs, post-hooks | Couplé à MEMORY_UPDATE obligatoire et Event Bus `emit`, sans différencier déclencheurs prompt/CLI.【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L21-L138】 |
| RULES_INDEX | 0.1.0 | Index limité (paths, patterns, templates, acceptance, workflows) | Ne référence pas ARKORE15/17 ni la matrice d'intents, ce qui limite la découverte gouvernance promptée.【F:ARKA_CORE/rules_index.yaml†L1-L36】 |

## Carte des Intents et leur portée
### Synthèse consolidée
- Cartographie statique construite dans `docs/gov-rules-prompts-map.yaml`, couvrant les rôles AGP, Archiviste, Lead Dev et PMO avec leurs intents déclarés et référentiels de prérequis.【F:docs/gov-rules-prompts-map.yaml†L1-L61】
- Les profils gouvernance (AGP, PMO) héritent des prérequis `all` et `common`, ajoutant des contraintes spécifiques (ex : `DECISION_PUBLISH` requiert `GATE_PASSED` + `EVIDENCE_COMPLETE`).【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L53-L90】
- Les profils d'exécution (Lead Dev, QA, DevOps) exposent des intents orientés delivery/tests, adossés aux prérequis `lead_dev`, `qa`, etc. (tests pass, build/lint).【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L92-L127】【F:wakeup-intents.matrix.yaml†L110-L179】

### Détails par rôle (extraits)
| Agent | Default intent | Intents déclarés | Sources clés | Observations |
| --- | --- | --- | --- | --- |
| AGP | ADR_CREATE | ADR_CREATE, DECISION*, ORDER*, DOCUMENT*, GATE*, REVIEW_DELIVERABLE | Wakeup matrix, expert AGP, prereqs `agp` | Rôle gouvernance complet mais dépend de mapping manuel vers action_keys ; couplage fort au contrôle AGP.【F:wakeup-intents.matrix.yaml†L5-L11】【F:ARKA_AGENT/client/acme/experts/ARKA_AGENT15-agp.yaml†L18-L30】 |
| Archiviste | ARCHIVE_CAPTURE | ARCHIVE_CAPTURE, PLAN_WORKFLOW, REVIEW_DELIVERABLE | Wakeup file, matrix (intents vide), prereqs `devops` | Désalignement matrix ↔ wakeup ; risque d'omission lors de génération des prompts.【F:wakeup-intents.matrix.yaml†L12-L18】【F:ARKA_AGENT/client/acme/wakeup/ARKAA08-WAKEUP-ARCHIVIST.yaml†L1-L22】 |
| Lead Dev | TICKET_CREATE | DELIVERY_SUBMIT, DOCUMENT*, REPORT_CREATE, TICKET* | Wakeup matrix, expert lead dev, prereqs `lead_dev` | Scope bien défini, prérequis tests/build mais pas de lien formel vers action_keys correspondantes.【F:wakeup-intents.matrix.yaml†L110-L116】【F:ARKA_AGENT/client/acme/experts/ARKA_AGENT04-lead-dev-batisseur.yaml†L18-L33】 |
| PMO | FEATURE_CREATE | DELEGATION_CREATE, DOCUMENT_READ, REPORT_CREATE, WORKFLOW_PLAN | Wakeup matrix, expert PMO, prereqs `pmo` | Intents orientés orchestration, dépend fortement d'ADR_EXISTS sans action déclarée côté action_keys.【F:wakeup-intents.matrix.yaml†L159-L165】【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L72-L80】 |

## Problèmes détectés
- **Matrice d'intents incomplète** — plusieurs agents ont `intents: []` dans `wakeup-intents.matrix.yaml` alors que leurs fichiers wakeup/experts listent des intents actifs (ex: archiviste). Cela induit un risque de prompts démarrant sans scope explicite.【F:wakeup-intents.matrix.yaml†L12-L39】【F:ARKA_AGENT/client/acme/wakeup/ARKAA08-WAKEUP-ARCHIVIST.yaml†L15-L21】
- **Absence de registre « intents → action_keys »** — les prérequis et alias reposent sur des chaînes librement nommées (`ORDER_CREATE`, `DECISION_PUBLISH`) sans garantie qu'une action correspondante existe dans ARKORE12 (alias manuel pour `ORDER_*`).【F:ARKA_AGENT/client/acme/ARKAA14-VOCAB-ALIASES.yaml†L6-L11】【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L21-L196】
- **Couplage implicite au Event Bus** — même si l'audit exclut Event Bus, ARKORE12 impose des post-hooks `ARKORE16-EVENT-BUS:emit.*` pour chaque action, brouillant la frontière entre triggers promptés et bus système.【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L28-L137】
- **Orchestration non versionnée côté intents** — ARKORE17 référence les briques (action keys, event bus, templates) mais ne précise pas quelle version minimale d'intents doit être chargée, ni comment vérifier l'exhaustivité de `available_intents` par profil.【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L7-L151】
- **Index des règles incomplet** — `rules_index.yaml` n'inclut ni ARKORE15 ni ARKORE17 ; les agents promptés n'ont donc pas de point d'entrée unique pour récupérer ces règles de gouvernance réactives et d'orchestration.【F:ARKA_CORE/rules_index.yaml†L1-L36】
- **Conditions/prérequis peu traçables** — des prérequis comme `TESTS_PASS`, `GATE_PASSED`, `EVIDENCE_COMPLETE` ne sont pas définis comme actions ou states dans ARKORE12, rendant le contrôle d'application difficile à automatiser.【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L53-L127】

## Suggestions (regroupement, refactor, extensions)
1. **Créer un registre ARKORE18-INTENTS-REGISTRY** centralisant pour chaque intent : action_key cible, contexte (gouvernance/exécution/support), slices applicables, conditions d'entrée/sortie, version minimale. Cela permettrait de générer automatiquement la matrice wakeup et de valider la cohérence des prérequis.【F:wakeup-intents.matrix.yaml†L5-L200】【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L21-L196】
2. **Automatiser la génération de `wakeup-intents.matrix.yaml`** depuis les fichiers wakeup/experts pour éviter les entrées vides et ajouter des métadonnées (scope, capacités, niveaux de gate). Un pipeline pourrait comparer la matrice calculée aux fichiers source et échouer en cas de divergence.【F:wakeup-intents.matrix.yaml†L12-L39】【F:ARKA_AGENT/client/acme/wakeup/ARKAA08-WAKEUP-ARCHIVIST.yaml†L15-L21】
3. **Étendre `rules_index.yaml`** pour inclure ARKORE15, ARKORE17, le futur registre d'intents et la matrice de wakeup, offrant un point d'entrée unique aux agents promptés.【F:ARKA_CORE/rules_index.yaml†L1-L36】【F:docs/gov-rules-prompts-map.yaml†L1-L31】
4. **Normaliser les prérequis et états** en les définissant dans ARKORE12 (ou une brique dédiée aux states) afin de relier `TESTS_PASS`, `GATE_PASSED`, etc., à des actions/contrôles mesurables et loggables (permettant RBAC, audits et validations automatiques).【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L53-L141】【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L21-L138】
5. **Découpler les post-hooks Event Bus pour les intents CLI/AGP** en introduisant un champ `post_prompt` distinct ou en rendant les hooks optionnels selon le canal, afin de clarifier les responsabilités entre prompts et Event Bus.【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L28-L137】
6. **Documenter dans chaque expert/wakeup** la version de référentiel d'intents chargée et exposer un checksum commun pour garantir que l'agent réveille la bonne configuration (permettant scalabilité multi-profils).【F:ARKA_AGENT/client/acme/experts/ARKA_AGENT15-agp.yaml†L17-L35】【F:ARKA_AGENT/client/acme/wakeup/ARKAA08-WAKEUP-ARCHIVIST.yaml†L13-L22】
