# Audit — Gouvernance & Règles Promptées (ARKA_OS)

## Résumé exécutif
- La gouvernance transversale repose sur quatre briques principales (ARKORE02, 06, 15, 17) qui définissent principes, seuils de contrôle et prérequis d'exécution ; elles sont bien versionnées mais leurs dépendances croisées restent fragiles faute de référentiel centralisé des intents et actions promptées.【F:ARKA_CORE/bricks/ARKORE02-GLOBAL-RULES.yaml†L1-L58】【F:ARKA_CORE/bricks/ARKORE06-CONTROL-MATRICES.yaml†L1-L68】【F:ARKA_CORE/bricks/ARKORE15-AGP-REACTIVE-CONTROL.yaml†L1-L88】【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L1-L152】
- Le routage d'intent utilisé par les prompts (CLI/agents) ne couvre qu'une douzaine d'actions (`intent_router`) alors que les wake-ups exposent 50+ intents différents, générant des trous systémiques et des intents orphelins non reliés à des `action_keys` exécutables.【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L577-L588】【F:wakeup-intents.matrix.yaml†L5-L200】
- Les prérequis d'orchestration (ARKORE17) référencent des actions absentes d'ARKORE12 (`ADR_CREATE`, `SPEC_CREATE`, etc.) et des pointeurs brisés vers la brique chemins, ce qui empêche de vérifier automatiquement les chaînes gouvernantes et affaiblit la scalabilité des règles lors de l'ajout de nouveaux agents.【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L72-L127】【F:ARKA_CORE/bricks/ARKORE08-PATHS-GOVERNANCE.yaml†L13-L78】
- Les documents d'onboarding et la matrice wake-up ↔ intents imposent que les experts n'invoquent que leurs intents autorisés, mais aucune validation ne rapproche ces listes des prérequis ARKORE17 ni du router ARKORE12 ; les incohérences identifiées bloquent toute montée en charge sans refonte du référentiel d'intents.【F:Docs/ARKA-CONCEPT-ONBOARDING.md†L61-L71】【F:wakeup-intents.matrix.yaml†L5-L200】

## Liste des règles gouvernantes actives
| Brique | Rôle | Portée | Observations |
| --- | --- | --- | --- |
| ARKORE02-GLOBAL-RULES | Principes, anti-dérive, isolation, procédures d'urgence | Tous agents & livrables | Règles explicites, invariants anti-duplication avec ARKORE06 mais pas de lien direct vers les intents/action keys ; nécessite synchronisation manuelle.【F:ARKA_CORE/bricks/ARKORE02-GLOBAL-RULES.yaml†L19-L58】 |
| ARKORE06-CONTROL-MATRICES | Matrices d'autorité, escalade, evidence & performance | Gouvernance transversale | Fournit seuils `chat_ttft`, obligations evidence, limitations PMO ; dépendances bien référencées vers ARKORE09 mais pas d'articulation avec intents spécifiques (ex. quelles actions déclenchent quel niveau d'evidence).【F:ARKA_CORE/bricks/ARKORE06-CONTROL-MATRICES.yaml†L10-L55】 |
| ARKORE12-ACTION-KEYS | Catalogue des actions promptables & macros | Execution via prompts | 96+ actions structurées ; `intent_router` restreint (11 entrées) et aucune section ne cartographie les intents wake-up ; la plupart des posts notifient Event Bus (hors périmètre) mais pas de métadonnées gouvernance (severity, evidence attendu).【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L20-L138】【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L520-L588】 |
| ARKORE15-AGP-REACTIVE-CONTROL | Boucles de contrôle en temps réel de l'AGP | AGP (no pause) | Actions `ACK`, `CONTROL_EVALUATE`, etc. orchestrées via références aux matrices de contrôle et templates ; bon découplage, mais ne précise pas comment les intents `DELIVERY_SUBMIT` ou `ORDER_ESCALATE` se lient à ces actions hors Event Bus.【F:ARKA_CORE/bricks/ARKORE15-AGP-REACTIVE-CONTROL.yaml†L11-L73】 |
| ARKORE17-ORCHESTRATION-RULES | Prérequis par rôle, contraintes d'orchestration | Agents métiers | Centralise transmissions et interdictions ; références vers ARKORE08 cassées (`exports.features` inexistant) et prérequis listent des actions non fournies par ARKORE12, ce qui invalide l'invariant "all prerequisites reference existing actions".【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L20-L144】【F:ARKA_CORE/bricks/ARKORE08-PATHS-GOVERNANCE.yaml†L13-L78】 |

## Carte des Intents et leur portée
### 1. Router d'intents (prompts CLI/Runner)
- `intent_router` d'ARKORE12 expose 11 clés (`CREATE_FEATURE`, `DELIVERY_SUBMIT`, `REVIEW_DELIVERABLE`, etc.) toutes mappées vers des `action_keys` internes.【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L577-L588】
- Ce router ne référence ni les intents gouvernance (`ADR_CREATE`, `DECISION_PUBLISH`) ni les intents métiers listés dans les wake-ups.

### 2. Prérequis d'orchestration (ARKORE17)
- Les rôles héritent d'un tronc commun (`MEMORY_UPDATE`, `VALIDATE_NAMING`, `CHECK_PATHS`) puis de prérequis spécifiques (`FEATURE_CREATE` nécessite `ADR_EXISTS`, `ADR_CREATE` demande `ANALYSIS_COMPLETE`, etc.).【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L34-L127】
- Plusieurs prérequis combinent deux conditions dans une même chaîne (`FEATURE_EXISTS,AGP_PASS_EXISTS`), rendant l'exploitation automatique difficile et contournant le contrat "chaque prérequis référence une action existante".【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L56-L100】

### 3. Matrice wake-up ↔ intents (hors Event Bus)
- 27 wake-ups recensés couvrent 53 intents distincts, avec des `default_intent` souvent absents du router (ex. `ADR_CREATE`, `SPEC_CREATE`, `SOURCING`).【F:wakeup-intents.matrix.yaml†L5-L200】
- Les profils sont supposés restreindre l'utilisation aux `available_intents`, mais aucune vérification ne garantit que ces intents disposent d'un `action_key` ou d'un prérequis valide.【F:Docs/ARKA-CONCEPT-ONBOARDING.md†L61-L71】【F:wakeup-intents.matrix.yaml†L5-L200】

### 4. Portée vs capacités
- Les experts référencent `system_rules_ref` (ARKORE17) et `orchestration_prereqs_ref`, mais ces pointeurs ne sécurisent pas la disponibilité effective des actions (`available_intents` peut contenir `GUIDELINES_CREATE` inexistant dans ARKORE12).【F:ARKA_AGENT/client/acme/experts/ARKA_AGENT24-brand-strategy-architect.yaml†L18-L32】【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L196-L588】
- Aucun mapping n'associe les intents à des capacités ou slices (ex. quelle compétence autorise `SIMULATION_RUN`). L'extension du système nécessitera un catalogue central.

## Problèmes détectés
1. **Intents sans action exécutable** : au moins 25 intents wake-up (ex. `ADR_CREATE`, `SPEC_CREATE`, `GUIDELINES_CREATE`) n'ont pas d'`action_key` dans ARKORE12, rendant impossible leur exécution via prompts et violant l'invariant d'ARKORE17.【F:wakeup-intents.matrix.yaml†L5-L200】【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L196-L588】【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L102-L127】
2. **Router minimal** : `intent_router` ne couvre qu'un sous-ensemble des intents (`CREATE_FEATURE`, `DELIVERY_SUBMIT`, etc.), laissant la majorité des intents non routables depuis le runner CLI ou les prompts AGP.【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L577-L588】
3. **Références cassées dans ARKORE17** : les clés `nomenclature.feature_path` & co pointent vers `ARKORE08-PATHS-GOVERNANCE:exports.features`, introuvable (seules les clés `paths.features_root`/`deliverables` existent), empêchant la résolution automatique des chemins pour les contrôles pré-action.【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L20-L44】【F:ARKA_CORE/bricks/ARKORE08-PATHS-GOVERNANCE.yaml†L13-L78】
4. **Prérequis non normalisés** : certaines contraintes combinent plusieurs états (`FEATURE_EXISTS,AGP_PASS_EXISTS`) ou référencent des statuts non définis ailleurs (`GATE_PASSED`, `RETRY_EXHAUSTED`) sans table de vérité ; cela rend le système difficile à valider et à étendre.【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L56-L100】
5. **Absence de mapping Intent ↔ Capacité** : ni ARKORE12 ni ARKORE17 n'associent les intents aux capacités déclarées dans les profils/experts ; les wake-ups doivent se fier à des commentaires humains, ce qui nuit à la scalabilité et à la conformité RBAC.【F:ARKA_AGENT/client/acme/experts/ARKA_AGENT15-agp.yaml†L18-L35】【F:wakeup-intents.matrix.yaml†L5-L200】
6. **Incohérence des documents contractuels** : `Docs/ARKA-CONCEPT-ONBOARDING` exige que seuls les intents du fichier expert soient utilisés, mais aucune mécanique ne synchronise cette liste avec `intent_router` ou ARKORE17, exposant les opérateurs à des erreurs de prompt runtime.【F:Docs/ARKA-CONCEPT-ONBOARDING.md†L61-L71】【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L577-L588】

## Suggestions (regroupement, refactor, extensions)
1. **Créer un `intent_catalog.yaml` central** regroupant pour chaque intent : `action_key` (ou statut manquant), rôle(s) autorisés, prérequis ARKORE17, evidence attendue (ARKORE06) et templates associés. Brancher ce catalogue sur le build matrix et sur `intent_router` pour garantir la cohérence (CI gate à ajouter).【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L577-L588】【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L34-L144】【F:wakeup-intents.matrix.yaml†L5-L200】
2. **Étendre `intent_router`** pour couvrir l'ensemble des intents autorisés par les experts, avec fallback explicite (ex. `unsupported_intent`), et exposer les transformations nécessaires (mapping direct ou alias) dans les macros de prompt.【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L520-L588】
3. **Aligner ARKORE17 ↔ ARKORE12** : ajouter les actions manquantes (ex. `ADR_CREATE`, `SPEC_CREATE`) dans ARKORE12 ou, a minima, introduire des `proxy_actions` qui redirigent vers des workflows composites. Mettre à jour les invariants CI pour refuser un prérequis pointant vers un intent inexistant.【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L102-L127】【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L196-L588】
4. **Corriger les références de nomenclature** en ARKORE17 pour utiliser les clés réelles (`paths.features_root`, `paths.deliverables.documents_root`, etc.) et fournir un schéma JSON décrivant ces références afin d'automatiser la résolution dans les prompts.【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L20-L44】【F:ARKA_CORE/bricks/ARKORE08-PATHS-GOVERNANCE.yaml†L13-L78】
5. **Normaliser les prérequis** : remplacer les chaînes concaténées par des listes (`[FEATURE_EXISTS, AGP_PASS_EXISTS]`), documenter ou créer les statuts manquants (`GATE_PASSED`, `RETRY_EXHAUSTED`) et lier chaque statut à une règle de gouvernance (ex. gate ARKORE06).【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L56-L127】
6. **Introduire un mapping Intent ↔ Capacité** (ex. `capability_matrix.yaml`) pour expliciter quelle capacité (profil, slice, skill) autorise chaque intent et synchroniser les wake-ups, facilitant l'ajout d'agents et la vérification RBAC statique.【F:wakeup-intents.matrix.yaml†L5-L200】【F:ARKA_AGENT/client/acme/experts/ARKA_AGENT15-agp.yaml†L18-L35】
7. **Documenter la relation prompts ↔ contrôle AGP** : enrichir ARKORE15 avec une table reliant chaque action du `action_map` aux intents qui la déclenchent (hors Event Bus) et aux checks des matrices de contrôle, pour clarifier l'exécution no-pause et les effets attendus.【F:ARKA_CORE/bricks/ARKORE15-AGP-REACTIVE-CONTROL.yaml†L15-L73】【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L520-L588】

