# Audit de structure ARKA_OS — checklist-audit-arka-v1

## Résumé exécutif
- La couche core est bien articulée autour d'un master assembly qui impose l'ordre de chargement des briques et un runner contractuel pour l'exécution des actions LLM.【F:ARKA_CORE/master-assembly.yaml†L1-L69】
- Les briques constitutionnelles couvrent la mémoire, le contrôle AGP et les matrices de gouvernance avec des références croisées systématiques, assurant une cohérence fonctionnelle forte.【F:ARKA_CORE/bricks/ARKORE14-MEMORY-OPS.yaml†L1-L80】【F:ARKA_CORE/bricks/ARKORE15-AGP-REACTIVE-CONTROL.yaml†L1-L88】【F:ARKA_CORE/bricks/ARKORE06-CONTROL-MATRICES.yaml†L1-L52】
- La couche profils/agents présente cependant des incohérences structurelles (doublons, références manquantes, mappings inexacts) qui fragilisent l'application des droits et le réveil des experts.【F:ARKA_PROFIL/bricks/ARKPR05-RIGHTS.yaml†L1-L118】【F:ARKA_AGENT/client/acme/ARKAA19-AGENT-CAPABILITIES.yaml†L14-L118】【F:ARKA_AGENT/client/acme/wakeup/ARKAA08-WAKEUP-AGP.yaml†L1-L32】
- L'orchestration build/extensibilité est partiellement implémentée : les scripts attendent une hiérarchie (profiles/, build/, scripts/) qui n'existe pas dans le repo courant, et plusieurs hooks Event Bus pointent vers des ressources absentes.【F:ARKA_CORE/readme.md†L51-L105】【F:bin/os-build.sh†L1-L17】【F:ARKA_CORE/bricks/ARKORE16-EVENT-BUS.yaml†L48-L85】【05438f†L1-L17】【27bffc†L1-L3】

## Points forts
- **Contrats d'assemblage explicites :** le master assembly impose l'ordre, les profils (default/dev-light/strict-security) et des invariants précis, ce qui balise clairement la construction multi-couche.【F:ARKA_CORE/master-assembly.yaml†L1-L49】
- **Mémoire normalisée et idempotente :** la brique MEMORY_OPS définit schéma, stockage, opérations et hooks avec références systématiques vers chemins et critères, garantissant traçabilité et cohérence des écritures.【F:ARKA_CORE/bricks/ARKORE14-MEMORY-OPS.yaml†L10-L79】
- **Boucle AGP réactive configurable :** la brique AGP-REACTIVE-CONTROL impose `pause_on_delivery: false`, un ack immédiat et des zones overridables pour adapter les contrôles sans briser la logique globale.【F:ARKA_CORE/bricks/ARKORE15-AGP-REACTIVE-CONTROL.yaml†L11-L73】
- **Règles d'orchestration riches :** ARKORE17 centralise les prérequis par rôle, les contraintes anti auto-validation et les gates workflow, renforçant l'alignement entre gouvernance et exécution.【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L18-L146】

## Points faibles ou ambigus
- **Arborescence attendue vs réelle :** la documentation core attend `profiles/`, `build/` et `scripts/handlers/` à la racine, mais seuls des dossiers sous `ARKA_CORE/` existent, rendant les commandes d'assemblage et les packs d'extensions inopérants sans ajustements.【F:ARKA_CORE/readme.md†L51-L105】【F:bin/os-build.sh†L1-L17】【05438f†L1-L17】
- **Event Bus incohérent :** la brique Event Bus publie des subscriptions locales vers `on_memory_update.sh` inexistant et définit un `dispatch.base_dir` sur `scripts/` alors que les scripts résident sous `ARKA_CORE/scripts/handlers`, bloquant les hooks par défaut.【F:ARKA_CORE/bricks/ARKORE16-EVENT-BUS.yaml†L48-L85】【27bffc†L1-L3】
- **Action keys vs Event Bus :** les gabarits d'action keys postent vers `ARKORE16-EVENT-BUS:emit.*` alors que la brique Event Bus n'exporte pas de section `emit`, créant des références orphelines dans toute la couche LLM.【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L21-L137】【F:ARKA_CORE/bricks/ARKORE16-EVENT-BUS.yaml†L9-L85】
- **Profils incohérents :** la brique RIGHTS déclare deux fois `agp_rights` et utilise des sets `create_structure` absents d'ARKPR03, rompant l'invariant de cohérence des références d'actions.【F:ARKA_PROFIL/bricks/ARKPR05-RIGHTS.yaml†L6-L58】【F:ARKA_PROFIL/bricks/ARKPR03-ACTION-SETS.yaml†L5-L23】
- **Catalogue & capacités désalignés :** ARKAA19 référence `use_profile: pmo-orchestrator` et `capabilities_ref` pour `technical_architect` qui n'existent pas dans le catalogue/agent capabilities, ce qui empêche la résolution des wake-ups et du RBAC effectif.【F:ARKA_AGENT/client/acme/ARKAA19-AGENT-CAPABILITIES.yaml†L32-L107】【F:ARKA_PROFIL/bricks/ARKPR08-PROFILES-CATALOG.yaml†L5-L26】【F:ARKA_AGENT/client/acme/wakeup/ARKAA08-WAKEUP-TECHNICAL_ARCHITECT.yaml†L1-L24】
- **Wake-ups pointant vers des intents inexistants :** plusieurs réveils (AGP, technical architect) définissent `default_intent: ADR_CREATE`, action absente du référentiel ARKORE12, entraînant des intents impossibles à résoudre dès l'initialisation.【F:ARKA_AGENT/client/acme/wakeup/ARKAA08-WAKEUP-AGP.yaml†L19-L23】【F:ARKA_AGENT/client/acme/wakeup/ARKAA08-WAKEUP-TECHNICAL_ARCHITECT.yaml†L19-L23】【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L21-L137】
- **Duplication dans l'assemblage agent :** le profil par défaut inclut `ARKAA08-WAKEUP-AGP` deux fois, signalant un manque de revue des enablements et un risque de collisions lors du merge final.【F:ARKA_AGENT/master-agent.yaml†L12-L41】

## Recommandations concrètes
- **Aligner l'arborescence build/overrides** : déplacer/dupliquer `ARKA_CORE/profiles/dev.override.yaml` vers `profiles/` à la racine et exposer `scripts/handlers/` en miroir du chemin documenté, ou ajuster les chemins dans la documentation, les scripts de build et les packs d'extensions.【F:ARKA_CORE/readme.md†L51-L105】【F:bin/os-build.sh†L1-L17】【05438f†L1-L17】
- **Normaliser l'Event Bus** : créer la section `exports.emit` (ou modifier les post-hooks des action keys pour utiliser `topics`) et fournir les scripts référencés (`on_memory_update.sh`) sous le `base_dir` effectif pour restaurer la rejouabilité et l'instrumentation.【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L21-L137】【F:ARKA_CORE/bricks/ARKORE16-EVENT-BUS.yaml†L48-L85】
- **Corriger les sets de permissions** : ajouter un `create_structure` dans ARKPR03 ou remplacer les références dans ARKPR05, supprimer le doublon `agp_rights` et compléter chaque profil (`agp`) avec un bloc `limits` cohérent.【F:ARKA_PROFIL/bricks/ARKPR03-ACTION-SETS.yaml†L5-L23】【F:ARKA_PROFIL/bricks/ARKPR05-RIGHTS.yaml†L6-L58】【F:ARKA_PROFIL/bricks/ARKPR08-PROFILES-CATALOG.yaml†L5-L26】
- **Synchroniser catalogue ↔ capacités ↔ wake-ups** : créer le profil `pmo-orchestrator` ou référencer `arka-product-manager-officer`, ajouter l'entrée `technical_architect` dans ARKAA19 (permissions format ARKPR09) et vérifier que chaque `capabilities_ref`/`use_profile_ref` pointe vers un identifiant existant.【F:ARKA_AGENT/client/acme/ARKAA19-AGENT-CAPABILITIES.yaml†L14-L107】【F:ARKA_PROFIL/bricks/ARKPR08-PROFILES-CATALOG.yaml†L5-L26】【F:ARKA_AGENT/client/acme/wakeup/ARKAA08-WAKEUP-TECHNICAL_ARCHITECT.yaml†L5-L23】
- **Mettre à jour les intents disponibles** : soit ajouter les actions ADR (ADR_CREATE, etc.) dans ARKORE12, soit ajuster les wake-ups et ARKORE17 pour n'utiliser que les action keys réellement exportées, afin d'éviter les échecs de routage d'intent.【F:ARKA_CORE/bricks/ARKORE12-ACTION-KEYS.yaml†L21-L160】【F:ARKA_CORE/bricks/ARKORE17-ORCHESTRATION-RULES.yaml†L96-L133】【F:ARKA_AGENT/client/acme/wakeup/ARKAA08-WAKEUP-AGP.yaml†L19-L23】
- **Sécuriser l'assemblage agent** : dédupliquer la liste `enable` du master agent et vérifier la cohérence des dépendances (`requires` vers les builds générés) pour garantir qu'une exécution `bin/os-build.sh` produit un bundle complet sans erreurs de résolution.【F:ARKA_AGENT/master-agent.yaml†L1-L41】【F:bin/os-build.sh†L1-L17】
